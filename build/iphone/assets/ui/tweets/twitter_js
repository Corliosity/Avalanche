function twitter(e){function s(){var e=new Date,t=e.getMonth()+"/"+e.getDate()+"/"+e.getFullYear();return e.getHours()>=12?t+=" "+(e.getHours()==12?e.getHours():e.getHours()-12)+":"+e.getMinutes()+" PM":t+=" "+e.getHours()+":"+e.getMinutes()+" AM",t}var t=Ti.Platform.osname,n=require("services/goavsgo"),r=new n,i=Ti.UI.createWindow({title:"Follow the Avs",backgroundImage:"images/nhl_bg.png",backButtonTitle:"Back",barColor:"#4099FF",activity:t=="iphone"?"":{onCreateOptionsMenu:function(t){var n=t.menu,r=n.add({title:"Tweet"}),i=n.add({title:"Refresh"});r.addEventListener("click",function(t){var n=require("ui/tweets/sendTweet");e.open(new n(e))}),i.addEventListener("click",function(){var e=require("services/goavsgo"),t=new e})}}}),o=[],u=Ti.UI.createTableView({backgroundColor:"transparent"}),a=Ti.UI.createView({backgroundColor:"#eaeaea",height:2,bottom:0}),f=Ti.UI.createView({backgroundColor:"#eaeaea",width:320,height:60}),l=Ti.UI.createView({backgroundImage:"images/whiteArrow.png",width:23,height:60,bottom:10,left:20}),c=Ti.UI.createLabel({text:"Pull to reload",left:55,width:200,bottom:30,height:"auto",color:"#000",textAlign:"center",font:{fontSize:13,fontWeight:"bold"},shadowColor:"#999",shadowOffset:{x:0,y:1}}),h=Ti.UI.createLabel({text:"Last Updated: "+s(),left:55,width:200,bottom:15,height:"auto",color:"#000",textAlign:"center",font:{fontSize:12},shadowColor:"#999",shadowOffset:{x:0,y:1}}),p=Ti.UI.createActivityIndicator({left:20,bottom:13,width:30,height:30});f.add(l),f.add(c),f.add(h),f.add(p),u.headerPullView=f,Ti.App.addEventListener("get.tweets",function(e){jsonArray=JSON.parse(e.responseText);var t=jsonArray.results;Ti.API.info("I am coming into being");for(var n=0;n<t.length;n++){var r=t[n].text,i=t[n].from_user,s=t[n].from_user_id_str,a=t[n].profile_image_url,f=t[n].id_str,l=t[n].entities.expanded_url,c=prettyDate(strtotime(t[n].created_at)),h=n%2==0?"#fff":"#eee",p=i=="createtheinno"?"#AD2B4E":"transparent",d=Ti.UI.createTableViewRow({height:100,backgroundColor:p}),v=Ti.UI.createView({height:"auto",layout:"vertical",left:5,top:5,bottom:5,right:5}),m=Ti.UI.createImageView({image:a,left:0,top:0,height:48,width:48});v.add(m);var g=Ti.UI.createLabel({text:i,left:54,width:120,top:-48,bottom:2,height:16,textAlign:"left",color:"#444444",font:{fontFamily:"Trebuchet MS",fontSize:14,fontWeight:"bold"}});v.add(g);var y=Ti.UI.createLabel({text:c,right:0,top:-18,bottom:2,height:14,textAlign:"right",width:110,color:"#444444",font:{fontFamily:"Trebuchet MS",fontSize:12}});v.add(y);var b=Ti.UI.createLabel({text:r,left:54,top:0,bottom:2,height:"auto",width:236,textAlign:"left",font:{fontSize:14},color:"#000"});v.add(b),d.add(v),d.className="item"+n,d.thisTweet=r,d.thisUser=i,d.thisURL=l,d.thisStr=f,d.thisImage=a,d.thisDate=c,o[n]=d}u.setData(o)}),u.addEventListener("click",function(t){Ti.API.info(t.row.thisURL);var n=require("/ui/tweets/responseTweet");e.open(new n(t.row.thisUser,t.row.thisTweet,t.row.thisImage,t.row.thisDate,t.row.thisStr,e))}),i.add(u);var d=Ti.UI.createButton({systemButton:Ti.UI.iPhone.SystemButton.COMPOSE});d.addEventListener("click",function(){var t=Ti.Platform.version.split("."),n=parseInt(t[0]);if(Ti.Platform.name=="iPhone OS"){var t=Ti.Platform.version.split("."),n=parseInt(t[0],10);if(n>=5){var r=require("com.0x82.twitter"),i=r.createTweetComposerView();i.canSendTweet()||alert("We cannot send a tweet now");var i=r.createTweetComposerView();i.setInitialText("#GoAvsGo"),i.addEventListener("complete",function(e){e.result==r.DONE&&alert("Your Tweet has been sent #GoAvsGo"),e.result==r.CANCELLED&&alert(":(  Sorry we cannot send your tweet now.")}),i.open()}else{var s=require("/ui/tweets/sendTweet");e.open(new s(e))}}}),t=="android"?"":i.setRightNavButton(d);if(t=="iphone"||t=="ipad"){u.addEventListener("scroll",function(e){Ti.API.info("Starting the listener");var t=e.contentOffset.y;if(t<=-65&&!v){var n=Ti.UI.create2DMatrix();n=n.rotate(-180),v=!0,l.animate({transform:n,duration:180}),c.text="Release to refresh..."}else if(v&&t>-65&&t<0){v=!1;var n=Ti.UI.create2DMatrix();l.animate({transform:n,duration:180}),c.text="Pull down to refresh..."}}),u.addEventListener("scrollEnd",function(e){Ti.API.info("Ending the event");var t=require("services/goavsgo"),n=new t;v&&!m&&e.contentOffset.y<=-65&&(m=!0,v=!1,l.hide(),p.show(),c.text="Reloading...",u.setContentInsets({top:60},{animated:!0}),l.transform=Ti.UI.create2DMatrix(),g())});var v=!1,m=!1;function g(){setTimeout(y,2e3)}function y(){u.setContentInsets({top:0},{animated:!0}),m=!1,h.text="Last Updated: "+s(),c.text="Pull down to refresh...",p.hide(),l.show()}}return i}function strtotime(e,t){var n,r,i,s="",o="";s=e,s=s.replace(/\s{2,}|^\s|\s$/g," "),s=s.replace(/[\t\r\n]/g,"");if(s=="now")return(new Date).getTime()/1e3;if(!isNaN(o=Date.parse(s)))return o/1e3;t?t=new Date(t*1e3):t=new Date,s=s.toLowerCase();var u={day:{sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},mon:{jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}},a=function(e){var n=e[2]&&e[2]=="ago",r=(r=e[0]=="last"?-1:1)*(n?-1:1);switch(e[0]){case"last":case"next":switch(e[1].substring(0,3)){case"yea":t.setFullYear(t.getFullYear()+r);break;case"mon":t.setMonth(t.getMonth()+r);break;case"wee":t.setDate(t.getDate()+r*7);break;case"day":t.setDate(t.getDate()+r);break;case"hou":t.setHours(t.getHours()+r);break;case"min":t.setMinutes(t.getMinutes()+r);break;case"sec":t.setSeconds(t.getSeconds()+r);break;default:var i;if(typeof (i=u.day[e[1].substring(0,3)])!="undefined"){var s=i-t.getDay();s==0?s=7*r:s>0?e[0]=="last"&&(s-=7):e[0]=="next"&&(s+=7),t.setDate(t.getDate()+s)}}break;default:if(!/\d+/.test(e[0]))return!1;r*=parseInt(e[0],10);switch(e[1].substring(0,3)){case"yea":t.setFullYear(t.getFullYear()+r);break;case"mon":t.setMonth(t.getMonth()+r);break;case"wee":t.setDate(t.getDate()+r*7);break;case"day":t.setDate(t.getDate()+r);break;case"hou":t.setHours(t.getHours()+r);break;case"min":t.setMinutes(t.getMinutes()+r);break;case"sec":t.setSeconds(t.getSeconds()+r)}}return!0};r=s.match(/^(\d{2,4}-\d{2}-\d{2})(?:\s(\d{1,2}:\d{2}(:\d{2})?)?(?:\.(\d+))?)?$/);if(r!=null){r[2]?r[3]||(r[2]+=":00"):r[2]="00:00:00",i=r[1].split(/-/g);for(n in u.mon)u.mon[n]==i[1]-1&&(i[1]=n);return i[0]=parseInt(i[0],10),i[0]=i[0]>=0&&i[0]<=69?"20"+(i[0]<10?"0"+i[0]:i[0]+""):i[0]>=70&&i[0]<=99?"19"+i[0]:i[0]+"",parseInt(this.strtotime(i[2]+" "+i[1]+" "+i[0]+" "+r[2])+(r[4]?r[4]/1e3:""),10)}var f="([+-]?\\d+\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday)|(last|next)\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday))(\\sago)?";r=s.match(new RegExp(f,"gi"));if(r==null)return!1;for(n=0;n<r.length;n++)if(!a(r[n].split(" ")))return!1;return t.getTime()/1e3}function prettyDate(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=new Date(e*1e3),r=((new Date).getTime()-n.getTime())/1e3,i=Math.floor(r/86400);if(isNaN(i)||i<0)return"";if(i>=31){var s=n.getFullYear(),o=t[n.getMonth()],u=n.getMonth()+1;u<10&&(u="0"+u);var a=n.getDate();return a<10&&(a="0"+a),a+" "+o+" "+s}return i==0&&(r<60&&"just now"||r<120&&"1 minute ago"||r<3600&&Math.floor(r/60)+" minutes ago"||r<7200&&"1 hour ago"||r<86400&&"about "+Math.floor(r/3600)+" hours ago")||i==1&&"Yesterday"||i<7&&i+" days ago"||i<31&&Math.ceil(i/7)+" week"+(Math.ceil(i/7)==1?"":"s")+" ago"}module.exports=twitter